<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>realisation notes about nachos</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="realisation-notes-about-nachos">
<h1 class="title">realisation notes about nachos</h1>
<h2 class="subtitle" id="part-one">Part one</h2>

<p>for the command <em>./nachos-userprog -d m -x ./halt</em>, we get :</p>
<pre class="code html literal-block">
Starting thread &quot;main&quot; at time 10
At PC = 0x0: JAL 52
At PC = 0x4: OR r1,r1,r0
At PC = 0xd0: ADDIU r29,r29,-24
At PC = 0xd4: SW r31,20(r29)
At PC = 0xd8: SW r30,16(r29)
At PC = 0xdc: ADDU r30,r29,r0
At PC = 0xe0: JAL 4
At PC = 0xe4: OR r1,r1,r0
At PC = 0x10: ADDIU r2,r0,0
At PC = 0x14: SYSCALL
Exception: syscall
Machine halting!

Ticks: total 19, idle 0, system 10, user 9
Disk I/O: reads 0, writes 0
Console I/O: reads 0, writes 0
Paging: faults 0
Network I/O: packets received 0, sent 0

Cleaning up...
</pre>
<p>for the command <em>./nachos-userprog -rs 0 -d m -x ./halt</em></p>
<pre class="code html literal-block">
Starting thread &quot;main&quot; at time 10
At PC = 0x0: JAL 52
At PC = 0x4: OR r1,r1,r0
At PC = 0xd0: ADDIU r29,r29,-24
At PC = 0xd4: SW r31,20(r29)
At PC = 0xd8: SW r30,16(r29)
At PC = 0xdc: ADDU r30,r29,r0
At PC = 0xe0: JAL 4
At PC = 0xe4: OR r1,r1,r0
At PC = 0x10: ADDIU r2,r0,0
At PC = 0x14: SYSCALL
Exception: syscall
Machine halting!

Ticks: total 19, idle 0, system 10, user 9
Disk I/O: reads 0, writes 0
Console I/O: reads 0, writes 0
Paging: faults 0
Network I/O: packets received 0, sent 0

Cleaning up...
</pre>
<p>with step by step instructions, (<em>./nachos-userprog -s -d m -x ./halt</em>),
we get :</p>
<pre class="code html literal-block">
Starting thread &quot;main&quot; at time 10
At PC = 0x0: JAL 52
Time: 11, interrupts on
Pending interrupts:
End of pending interrupts
Machine registers:
0:  0x0     1:      0x0     2:      0x0     3:      0x0
4:  0x0     5:      0x0     6:      0x0     7:      0x0
8:  0x0     9:      0x0     10:     0x0     11:     0x0
12: 0x0     13:     0x0     14:     0x0     15:     0x0
16: 0x0     17:     0x0     18:     0x0     19:     0x0
20: 0x0     21:     0x0     22:     0x0     23:     0x0
24: 0x0     25:     0x0     26:     0x0     27:     0x0
28: 0x0     SP(29): 0x570   30:     0x0     RA(31): 0x8
Hi: 0x0     Lo:     0x0
PC: 0x4     NextPC: 0xd0    PrevPC: 0x0
Load:       0x0     LoadV:  0x0

11&gt;
At PC = 0x4: OR r1,r1,r0
Time: 12, interrupts on
Pending interrupts:
End of pending interrupts
Machine registers:
0:  0x0     1:      0x0     2:      0x0     3:      0x0
4:  0x0     5:      0x0     6:      0x0     7:      0x0
8:  0x0     9:      0x0     10:     0x0     11:     0x0
12: 0x0     13:     0x0     14:     0x0     15:     0x0
16: 0x0     17:     0x0     18:     0x0     19:     0x0
20: 0x0     21:     0x0     22:     0x0     23:     0x0
24: 0x0     25:     0x0     26:     0x0     27:     0x0
28: 0x0     SP(29): 0x570   30:     0x0     RA(31): 0x8
Hi: 0x0     Lo:     0x0
PC: 0xd0    NextPC: 0xd4    PrevPC: 0x4
Load:       0x0     LoadV:  0x0

[...]
</pre>
<p>we add the following lines in halt.c :</p>
<pre class="code c literal-block">
<span class="keyword type">int</span> <span class="name">a</span> <span class="operator">=</span> <span class="literal number integer">30</span><span class="punctuation">;</span>
<span class="keyword type">int</span> <span class="name">b</span> <span class="operator">=</span> <span class="literal number integer">12</span><span class="punctuation">;</span>
<span class="keyword type">int</span> <span class="name">c</span> <span class="operator">=</span> <span class="name">a</span><span class="operator">+</span><span class="name">b</span><span class="punctuation">;</span>
</pre>
<p>we obtain the following instructions :</p>
<pre class="code c literal-block">
<span class="name">Starting</span> <span class="keyword reserved">thread</span> <span class="literal string">&quot;main&quot;</span> <span class="name">at</span> <span class="name">time</span> <span class="literal number integer">10</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x0</span><span class="operator">:</span> <span class="name">JAL</span> <span class="literal number integer">52</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x4</span><span class="operator">:</span> <span class="name">OR</span> <span class="name">r1</span><span class="punctuation">,</span><span class="name">r1</span><span class="punctuation">,</span><span class="name">r0</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xd0</span><span class="operator">:</span> <span class="name">ADDIU</span> <span class="name">r29</span><span class="punctuation">,</span><span class="name">r29</span><span class="punctuation">,</span><span class="operator">-</span><span class="literal number integer">40</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xd4</span><span class="operator">:</span> <span class="name">SW</span> <span class="name">r31</span><span class="punctuation">,</span><span class="literal number integer">36</span><span class="punctuation">(</span><span class="name">r29</span><span class="punctuation">)</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xd8</span><span class="operator">:</span> <span class="name">SW</span> <span class="name">r30</span><span class="punctuation">,</span><span class="literal number integer">32</span><span class="punctuation">(</span><span class="name">r29</span><span class="punctuation">)</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xdc</span><span class="operator">:</span> <span class="name">ADDU</span> <span class="name">r30</span><span class="punctuation">,</span><span class="name">r29</span><span class="punctuation">,</span><span class="name">r0</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xe0</span><span class="operator">:</span> <span class="name">ADDIU</span> <span class="name">r2</span><span class="punctuation">,</span><span class="name">r0</span><span class="punctuation">,</span><span class="literal number integer">30</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xe4</span><span class="operator">:</span> <span class="name">SW</span> <span class="name">r2</span><span class="punctuation">,</span><span class="literal number integer">24</span><span class="punctuation">(</span><span class="name">r30</span><span class="punctuation">)</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xe8</span><span class="operator">:</span> <span class="name">ADDIU</span> <span class="name">r2</span><span class="punctuation">,</span><span class="name">r0</span><span class="punctuation">,</span><span class="literal number integer">10</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xec</span><span class="operator">:</span> <span class="name">SW</span> <span class="name">r2</span><span class="punctuation">,</span><span class="literal number integer">20</span><span class="punctuation">(</span><span class="name">r30</span><span class="punctuation">)</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xf0</span><span class="operator">:</span> <span class="name">LW</span> <span class="name">r3</span><span class="punctuation">,</span><span class="literal number integer">24</span><span class="punctuation">(</span><span class="name">r30</span><span class="punctuation">)</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xf4</span><span class="operator">:</span> <span class="name">LW</span> <span class="name">r2</span><span class="punctuation">,</span><span class="literal number integer">20</span><span class="punctuation">(</span><span class="name">r30</span><span class="punctuation">)</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xf8</span><span class="operator">:</span> <span class="name">OR</span> <span class="name">r1</span><span class="punctuation">,</span><span class="name">r1</span><span class="punctuation">,</span><span class="name">r0</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0xfc</span><span class="operator">:</span> <span class="name">ADDU</span> <span class="name">r2</span><span class="punctuation">,</span><span class="name">r3</span><span class="punctuation">,</span><span class="name">r2</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x100</span><span class="operator">:</span> <span class="name">SW</span> <span class="name">r2</span><span class="punctuation">,</span><span class="literal number integer">16</span><span class="punctuation">(</span><span class="name">r30</span><span class="punctuation">)</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x104</span><span class="operator">:</span> <span class="name">LW</span> <span class="name">r2</span><span class="punctuation">,</span><span class="literal number integer">16</span><span class="punctuation">(</span><span class="name">r30</span><span class="punctuation">)</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x108</span><span class="operator">:</span> <span class="name">OR</span> <span class="name">r1</span><span class="punctuation">,</span><span class="name">r1</span><span class="punctuation">,</span><span class="name">r0</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x10c</span><span class="operator">:</span> <span class="name">ADDIU</span> <span class="name">r2</span><span class="punctuation">,</span><span class="name">r2</span><span class="punctuation">,</span><span class="literal number integer">2</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x110</span><span class="operator">:</span> <span class="name">SW</span> <span class="name">r2</span><span class="punctuation">,</span><span class="literal number integer">16</span><span class="punctuation">(</span><span class="name">r30</span><span class="punctuation">)</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x114</span><span class="operator">:</span> <span class="name">JAL</span> <span class="literal number integer">4</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x118</span><span class="operator">:</span> <span class="name">OR</span> <span class="name">r1</span><span class="punctuation">,</span><span class="name">r1</span><span class="punctuation">,</span><span class="name">r0</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x10</span><span class="operator">:</span> <span class="name">ADDIU</span> <span class="name">r2</span><span class="punctuation">,</span><span class="name">r0</span><span class="punctuation">,</span><span class="literal number integer">0</span>
<span class="name">At</span> <span class="name">PC</span> <span class="operator">=</span> <span class="literal number hex">0x14</span><span class="operator">:</span> <span class="name">SYSCALL</span>
<span class="name label">Exception</span><span class="punctuation">:</span> <span class="name">syscall</span>
<span class="name">Machine</span> <span class="name">halting</span><span class="operator">!</span>

<span class="name label">Ticks</span><span class="punctuation">:</span> <span class="name">total</span> <span class="literal number integer">32</span><span class="punctuation">,</span> <span class="name">idle</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">system</span> <span class="literal number integer">10</span><span class="punctuation">,</span> <span class="name">user</span> <span class="literal number integer">22</span>
<span class="name">Disk</span> <span class="name">I</span><span class="operator">/</span><span class="name label">O</span><span class="punctuation">:</span> <span class="name">reads</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">writes</span> <span class="literal number integer">0</span>
<span class="name">Console</span> <span class="name">I</span><span class="operator">/</span><span class="name label">O</span><span class="punctuation">:</span> <span class="name">reads</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">writes</span> <span class="literal number integer">0</span>
<span class="name label">Paging</span><span class="punctuation">:</span> <span class="name">faults</span> <span class="literal number integer">0</span>
<span class="name">Network</span> <span class="name">I</span><span class="operator">/</span><span class="name label">O</span><span class="punctuation">:</span> <span class="name">packets</span> <span class="name">received</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">sent</span> <span class="literal number integer">0</span>

<span class="name">Cleaning</span> <span class="name">up</span><span class="punctuation">...</span>
</pre>
<p>We see that the instruction <em>OR r1,r1,r0</em> is executed after
all jumps or Loads. We assume that it comes that the processor
is piplined and executes the next instruction before jumping
and the memory calls are slow in comparison to cache memory.</p>
<div class="section" id="nachos-threads">
<h1>nachos-threads</h1>
<p>After adding an another thread, we saw that it's working well. but it
seems not parallel between the two threads:</p>
<pre class="code c literal-block">
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="name">No</span> <span class="name">threads</span> <span class="name">ready</span> <span class="name">or</span> <span class="name">runnable</span><span class="punctuation">,</span> <span class="name">and</span> <span class="name">no</span> <span class="name">pending</span> <span class="name">interrupts</span><span class="punctuation">.</span>
<span class="name">Assuming</span> <span class="name">the</span> <span class="name">program</span> <span class="name">completed</span><span class="punctuation">.</span>
<span class="name">Machine</span> <span class="name">halting</span><span class="operator">!</span>

<span class="name label">Ticks</span><span class="punctuation">:</span> <span class="name">total</span> <span class="literal number integer">250</span><span class="punctuation">,</span> <span class="name">idle</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">system</span> <span class="literal number integer">250</span><span class="punctuation">,</span> <span class="name">user</span> <span class="literal number integer">0</span>
<span class="name">Disk</span> <span class="name">I</span><span class="operator">/</span><span class="name label">O</span><span class="punctuation">:</span> <span class="name">reads</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">writes</span> <span class="literal number integer">0</span>
<span class="name">Console</span> <span class="name">I</span><span class="operator">/</span><span class="name label">O</span><span class="punctuation">:</span> <span class="name">reads</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">writes</span> <span class="literal number integer">0</span>
<span class="name label">Paging</span><span class="punctuation">:</span> <span class="name">faults</span> <span class="literal number integer">0</span>
<span class="name">Network</span> <span class="name">I</span><span class="operator">/</span><span class="name label">O</span><span class="punctuation">:</span> <span class="name">packets</span> <span class="name">received</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">sent</span> <span class="literal number integer">0</span>

<span class="name">Cleaning</span> <span class="name">up</span><span class="punctuation">...</span>
</pre>
<p>When removing currentThread-&gt;Yield();
we see that there is no more parallelism :</p>
<pre class="code c literal-block">
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="name">No</span> <span class="name">threads</span> <span class="name">ready</span> <span class="name">or</span> <span class="name">runnable</span><span class="punctuation">,</span> <span class="name">and</span> <span class="name">no</span> <span class="name">pending</span> <span class="name">interrupts</span><span class="punctuation">.</span>
<span class="name">Assuming</span> <span class="name">the</span> <span class="name">program</span> <span class="name">completed</span><span class="punctuation">.</span>
<span class="name">Machine</span> <span class="name">halting</span><span class="operator">!</span>

<span class="name label">Ticks</span><span class="punctuation">:</span> <span class="name">total</span> <span class="literal number integer">50</span><span class="punctuation">,</span> <span class="name">idle</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">system</span> <span class="literal number integer">50</span><span class="punctuation">,</span> <span class="name">user</span> <span class="literal number integer">0</span>
<span class="name">Disk</span> <span class="name">I</span><span class="operator">/</span><span class="name label">O</span><span class="punctuation">:</span> <span class="name">reads</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">writes</span> <span class="literal number integer">0</span>
<span class="name">Console</span> <span class="name">I</span><span class="operator">/</span><span class="name label">O</span><span class="punctuation">:</span> <span class="name">reads</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">writes</span> <span class="literal number integer">0</span>
<span class="name label">Paging</span><span class="punctuation">:</span> <span class="name">faults</span> <span class="literal number integer">0</span>
<span class="name">Network</span> <span class="name">I</span><span class="operator">/</span><span class="name label">O</span><span class="punctuation">:</span> <span class="name">packets</span> <span class="name">received</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="name">sent</span> <span class="literal number integer">0</span>

<span class="name">Cleaning</span> <span class="name">up</span><span class="punctuation">...</span>
</pre>
<p>We use the option -rs n :</p>
<pre class="code c literal-block">
<span class="punctuation">.</span><span class="operator">/</span><span class="name">nachos</span><span class="operator">-</span><span class="name">threads</span> <span class="operator">-</span><span class="name">rs</span> <span class="literal number integer">5</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="punctuation">[...]</span>

<span class="punctuation">.</span><span class="operator">/</span><span class="name">nachos</span><span class="operator">-</span><span class="name">threads</span> <span class="operator">-</span><span class="name">rs</span> <span class="literal number integer">4</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">0</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">0</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">1</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">2</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">1</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">3</span> <span class="name">times</span>
<span class="operator">***</span> <span class="keyword reserved">thread</span> <span class="literal number integer">2</span> <span class="name">looped</span> <span class="literal number integer">4</span> <span class="name">times</span>
<span class="punctuation">[...]</span>
</pre>
<p>When the seed is initialized differently, we see different executions.
This is because the system use pseudo-random numbers for interrupting threads. Using different seeds for each execution simulate a real system (non deterministic).</p>
</div>
<div class="section" id="scheduler-overview">
<h1>Scheduler overview</h1>
<p>we save the old level of interrupt and restore it at the end of Yield.
If there is an another thread to run, we run this thread.</p>
<p>The Scheduler class implements a simple round robin algorihtm. It keeps a list
of thread to execute. ReadyToRun add a thread to the readyList. The FindNextToRun method remove the first element of readyList and returns it.
Run method save context of current thread and switch the threads.</p>
<p>The genuine method for switching context is SWITCH which is a machine-dependent assembly language routine defined in switch.s.</p>
</div>
<div class="section" id="exercise">
<h1>Exercise</h1>
<p>After making modifications in Yield, we see that ./nachos-threads execute
a thread twice before switching context, which is normal.</p>
</div>
</div>
</body>
</html>
